{"ast":null,"code":"import _objectSpread from\"/home/cedcoss/mark01/A-React Work/01_firstReactApp/81_chatServer/chat-server/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/home/cedcoss/mark01/A-React Work/01_firstReactApp/81_chatServer/chat-server/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useRef,useState}from'react';import{ChatElement}from'./ChatElement';import{ref,push,getDatabase,onValue}from\"firebase/database\";import app from'../firebaseConfig';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(_ref){var authUser=_ref.authUser;var chatBox=useRef(null);var db=getDatabase(app);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),conversation=_useState2[0],setConversation=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];// get data from firebase\nuseEffect(function(){var todoRef=ref(db,\"/messages\");onValue(todoRef,function(snapshot){var todos=snapshot.val();var newChats=[];for(var id in todos){newChats.push(_objectSpread({id:id},todos[id]));};setTimeout(function(){console.log(newChats);setConversation(newChats);setLoading(false);},5);});},[db]);// auto top\nuseEffect(function(){if(!loading)chatBox.current.scrollTop=chatBox.current.scrollHeight;},[conversation,loading]);// Add Data to firebase\nvar Sender=function Sender(e){e.preventDefault();if(!e.target.message.value)return console.log('empty Input');var months=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"];var input={createdAt:\"\".concat(new Date().getDate(),\" \").concat(months[new Date().getMonth()],\" \").concat(new Date().getHours(),\":\").concat(new Date().getMinutes()),txt:e.target.message.value,uid:authUser.uid,userPic:authUser.photoURL};push(ref(db,\"/messages\"),input);e.target.reset();};console.log(loading);if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"d-flex col-12 align-items-center justify-content-center vh-100 \",children:/*#__PURE__*/_jsx(\"img\",{src:\"Triangles-1s-200px (1).gif\",style:{width:'50px'},alt:\"\"})});return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"col-12 d-flex flex-column justify-content-between \",children:[/*#__PURE__*/_jsx(\"div\",{ref:chatBox,className:\"container col-12 border my-2 p-2 chatBox\",children:conversation.map(function(msgs){return/*#__PURE__*/_jsx(ChatElement,{msg:msgs,name:authUser.displayName,align:authUser.uid===msgs.uid?'msg-right':'msg-left'});})}),/*#__PURE__*/_jsxs(\"form\",{className:\"input-group my-3\",onSubmit:Sender,style:{height:'8vh'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",name:\"message\",placeholder:\"messaging...\",\"aria-label\":\"Recipient's username\",\"aria-describedby\":\"button-addon2\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",type:\"submit\",id:\"button-addon2\",children:\"Send\"})]})]})});};export default Home;","map":{"version":3,"names":["React","useEffect","useRef","useState","ChatElement","ref","push","getDatabase","onValue","app","Home","authUser","chatBox","db","conversation","setConversation","loading","setLoading","todoRef","snapshot","todos","val","newChats","id","setTimeout","console","log","current","scrollTop","scrollHeight","Sender","e","preventDefault","target","message","value","months","input","createdAt","Date","getDate","getMonth","getHours","getMinutes","txt","uid","userPic","photoURL","reset","width","map","msgs","displayName","height"],"sources":["/home/cedcoss/mark01/A-React Work/01_firstReactApp/81_chatServer/chat-server/src/pages/Home.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react'\nimport { ChatElement } from './ChatElement'\nimport { ref, push, getDatabase, onValue } from \"firebase/database\";\nimport app from '../firebaseConfig';\n\n\ninterface Message {\n    id?: string\n    createdAt: string\n    txt: string\n    uid: string\n    userPic: string\n}\n\nconst Home = ({ authUser }: any) => {\n    const chatBox=useRef<any>(null)\n    const db = getDatabase(app);\n    const [conversation, setConversation] = useState<Message[]>([])\n    const [loading,setLoading]=useState<boolean>(true)\n\n// get data from firebase\nuseEffect(() => {\n    const todoRef = ref(db, \"/messages\");\n    onValue(todoRef, (snapshot) => {\n        const todos = snapshot.val();\n        let newChats: Message[] = [];\n        for (let id in todos) {\n            newChats.push({ id, ...todos[id] });\n        };\n        setTimeout(() => {\n            console.log(newChats)\n            setConversation(newChats)\n            setLoading(false)\n        }, 5)\n        \n    })\n}, [db]);\n\n// auto top\nuseEffect(()=>{\n    if(!loading)\n    chatBox.current.scrollTop = chatBox.current.scrollHeight;\n},[conversation,loading]);\n\n// Add Data to firebase\nconst Sender = (e: any) => {\n    e.preventDefault()\n    if(!e.target.message.value)\n    return console.log('empty Input')\n    const months = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n    let input: Message = {\n        createdAt: `${new Date().getDate()} ${months[new Date().getMonth()]} ${new Date().getHours()}:${new Date().getMinutes()}`,\n        txt: e.target.message.value,\n        uid: authUser.uid,\n        userPic: authUser.photoURL\n    }\n    push(ref(db, `/messages`), input);\n    e.target.reset();\n}\n\nconsole.log(loading)\n    if(loading)\n    return <div className=\"d-flex col-12 align-items-center justify-content-center vh-100 \">\n<img src=\"Triangles-1s-200px (1).gif\" style={{width:'50px'}} alt=\"\" />\n    </div>\n\n    return (\n        <>\n            <div className=\"col-12 d-flex flex-column justify-content-between \">\n                <div ref={chatBox}  className=\"container col-12 border my-2 p-2 chatBox\">   \n                    {\n                        conversation.map(msgs => {\n                            return <ChatElement msg={msgs} name={authUser.displayName} align={(authUser.uid === msgs.uid) ? 'msg-right' : 'msg-left'} />\n                        })\n                    }\n                </div>\n                <form className=\"input-group my-3\" onSubmit={Sender} style={{ height: '8vh' }}>\n                    <input type=\"text\" className=\"form-control\" name=\"message\" placeholder=\"messaging...\" aria-label=\"Recipient's username\" aria-describedby=\"button-addon2\" />\n                    <button className=\"btn btn-primary\" type=\"submit\" id=\"button-addon2\">Send</button>\n                </form>\n            </div>\n        </>\n    )\n}\n\nexport default Home"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}